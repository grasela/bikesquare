<div class="showprofile">

    <strong><p>Purchase summary</p></strong>

    <%= flash[:notice] %>
    <div class="review profile-card">
        <p>Buyer: <%= @buyer.profile.username   %></p>
        <p>Seller: <%= @seller.profile.username %></p>
        <p>Bike: <%= @bicycle.title %></p>
        <p>Pick up address <%= @delivery_address.address %></p>
            <div class="map">
                <%= image_tag ("https://maps.googleapis.com/maps/api/staticmap?center=#{@delivery_address.latitude},#{@delivery_address.longitude}&zoom=12&size=400x200&markers=color:blue%7Clabel:#{@seller.profile.first_name.first}%7C#{@delivery_address.latitude},#{@delivery_address.longitude}&key=#{ENV.fetch('GOOGLE_KEY')}") %>
            </div>
        <p>Price:  <%= number_to_currency(@price, unit: "AUD $") %> </p>

        <% if @purchase.payed_at.nil?  %>
            <%= form_tag charge_purchase_path do %>
                <article>
                    <% if flash[:error].present? %>
                        <div id="error_explanation">
                            <p><%= flash[:error] %></p>
                        </div>
                    <% end %>
                </article>

                <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                                                                      data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
                                                                      data-description=<%= @bicycle.title %>
                                                                  data-amount= <%= @amount %>
                                                                  data-email= <%= @buyer.email %>
                                                                  data-locale="auto"></script>
            <% end %>
        <%end %>
    </div>
